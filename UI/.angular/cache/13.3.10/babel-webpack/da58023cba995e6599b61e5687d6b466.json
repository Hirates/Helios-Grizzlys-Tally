{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Confirmable } from 'src/app/_decorators/confirmable.decorator';\nimport { versions } from 'src/environments/versions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/_services/socket.service\";\nimport * as i3 from \"src/app/_services/navbar-visibility.service\";\nimport * as i4 from \"src/app/_services/locationBack.service\";\nimport * as i5 from \"@angular/common\";\n\nfunction ErrorReportComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"div\", 5);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ErrorReportComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7)(2, \"h1\");\n    i0.ɵɵtext(3, \":(\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h2\");\n    i0.ɵɵtext(5, \"There was an unexpected error. Please open a bug report on the project's Github page or contact one of the developers.\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 8)(7, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function ErrorReportComponent_div_4_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return ctx_r3.bugReportButtonClick();\n    });\n    i0.ɵɵtext(8, \"Open a bug report on Github\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\", 10)(10, \"h3\");\n    i0.ɵɵtext(11, \"Stacktrace:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"pre\", 11);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"div\", 10)(15, \"h3\");\n    i0.ɵɵtext(16, \"Error datetime\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"h4\");\n    i0.ɵɵtext(18);\n    i0.ɵɵpipe(19, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"div\", 12)(21, \"div\", 10)(22, \"h3\");\n    i0.ɵɵtext(23, \"Logs:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"pre\", 13);\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(26, \"div\", 10)(27, \"h3\");\n    i0.ɵɵtext(28, \"Config file:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"pre\", 14);\n    i0.ɵɵtext(30);\n    i0.ɵɵpipe(31, \"json\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.bugReportUrlLoaded);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r1.currentReport.stacktrace);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(19, 5, ctx_r1.currentReport.datetime, \"YYYY-MM-dd HH:mm:ss\"));\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(ctx_r1.currentReport.logs);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(31, 8, ctx_r1.currentReport.config));\n  }\n}\n\nfunction ErrorReportComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7)(2, \"h1\");\n    i0.ɵɵtext(3, \":(\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h2\");\n    i0.ɵɵtext(5, \"Error report not found.\");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nexport class ErrorReportComponent {\n  constructor(route, socketService, navbarVisibilityService, locationBackService, renderer, el) {\n    this.route = route;\n    this.socketService = socketService;\n    this.navbarVisibilityService = navbarVisibilityService;\n    this.locationBackService = locationBackService;\n    this.renderer = renderer;\n    this.el = el;\n    this.currentReportId = \"blank\";\n    this.currentReport = {};\n    this.loading = true;\n    this.validReport = false;\n    this.bugReportUrl = \"\";\n    this.bugReportUrlLoaded = false;\n    this.bugReportShowForkWarning = false;\n    navbarVisibilityService.hideNavbar();\n    this.route.params.subscribe(params => {\n      if (params.errorReportId) {\n        this.currentReportId = params.errorReportId;\n      }\n    });\n  }\n\n  ngAfterViewInit() {\n    this.renderer.setStyle(this.el.nativeElement.ownerDocument.body, 'background', '#3973aa');\n  }\n\n  checkIfIssuesEnabled(url) {\n    /* @ts-ignore: All code paths resolve the promise */\n    return new Promise((resolve, reject) => {\n      if (new URL(url).host !== \"github.com/\") resolve(false);\n      let repo = url.split(\"github.com/\")[1].split(\"/\", 2).join(\"/\").toLowerCase();\n\n      switch (repo) {\n        case \"josephdadams/tallyarbiter\":\n          //assume that our repo has always issues enabled\n          resolve(true);\n          break;\n\n        default:\n          fetch(`https://api.github.com/repos/${repo}`, {\n            cache: \"no-store\"\n          }).then(response => {\n            response.json().then(data => {\n              resolve(data.has_issues);\n            }).catch(() => {\n              resolve(false);\n            });\n          }).catch(() => {\n            resolve(false);\n          });\n      }\n    });\n  }\n\n  generateBugReportUrlParams(bugTitle, version, config, logs, stacktrace, runningRecursive = false) {\n    //https://medium.com/@DylanAttal/truncate-a-string-in-javascript-41f33171d5a8\n    function truncateString(str, num) {\n      // If the length of str is less than or equal to num\n      // just return str--don't truncate it.\n      if (str.length <= num) {\n        return str;\n      } // Return str truncated with '...' concatenated to the end of str.\n\n\n      return str.slice(0, num) + '...';\n    }\n\n    let bugReportUrl = `/issues/new?labels=bug&template=bug.yaml&title=${encodeURIComponent(bugTitle)}&version=${version}&config=${encodeURIComponent(JSON.stringify(config, null, 2))}&logs=${encodeURIComponent(logs)}&stacktrace=${encodeURIComponent(stacktrace)}`;\n\n    if (bugReportUrl.length > 8140 && !runningRecursive) {\n      bugTitle = truncateString(bugTitle, 60);\n      let logs_split = logs.split('\\n');\n\n      if (logs_split.length > 10) {\n        logs_split.splice(0, logs_split.length - 5);\n        logs = logs_split.join('\\n');\n      }\n\n      delete config.tsl_clients;\n      delete config.tsl_clients_1secupdate;\n      delete config.cloud_destinations;\n      delete config.cloud_keys;\n      bugReportUrl = this.generateBugReportUrlParams(bugTitle, version, config, logs, stacktrace, true);\n    }\n\n    if (bugReportUrl.length > 8140 && runningRecursive) {\n      config = {\n        error: \"config redacted since the issue url was too long\"\n      };\n      bugReportUrl = this.generateBugReportUrlParams(bugTitle, version, config, logs, stacktrace, true);\n    }\n\n    return bugReportUrl;\n  }\n\n  generateBugReportUrl(bugTitle, version, config, logs, stacktrace) {\n    return new Promise((resolve, reject) => {\n      this.checkIfIssuesEnabled(versions.remote_url).then(issuesEnabled => {\n        let repo_url = \"\";\n\n        if (issuesEnabled) {\n          repo_url = versions.remote_url;\n        } else {\n          repo_url = \"https://github.com/josephdadams/TallyArbiter\";\n          this.bugReportShowForkWarning = true;\n        }\n\n        console.log(`Issues ${issuesEnabled ? \"enabled\" : \"disabled\"} for the repo ${repo_url}.`);\n        resolve(`${repo_url}${this.generateBugReportUrlParams(bugTitle, version, config, logs, stacktrace)}`);\n      });\n    });\n  }\n\n  bugReportButtonClick() {\n    if (this.bugReportShowForkWarning) {\n      this.bugReportForkWarning();\n    } else {\n      open(this.bugReportUrl, \"_blank\");\n    }\n  }\n\n  bugReportForkWarning() {\n    this.bugReportUrl = this.bugReportUrl.replace(\"labels=bug\", \"labels=bug,fork\");\n    open(this.bugReportUrl, \"_blank\");\n  }\n\n  ngOnInit() {\n    this.socketService.getErrorReportById(this.currentReportId).then(errorReport => {\n      this.currentReport = errorReport;\n      this.loading = false;\n      this.validReport = true;\n      let bugTitle = \"[Bug] \" + this.currentReport.stacktrace.split(\"\\n\")[0];\n      this.generateBugReportUrl(bugTitle, this.socketService.version, this.currentReport.config, this.currentReport.logs, this.currentReport.stacktrace).then(response => {\n        this.bugReportUrl = response;\n        this.bugReportUrlLoaded = true;\n      });\n      console.log(\"Error report found:\");\n      console.log(errorReport);\n    }).catch(response => {\n      this.loading = false;\n      console.log(\"Error report not found\");\n    });\n  }\n\n  ngOnDestroy() {\n    this.renderer.removeStyle(this.el.nativeElement.ownerDocument.body, 'background');\n    this.navbarVisibilityService.showNavbar();\n  }\n\n}\n\nErrorReportComponent.ɵfac = function ErrorReportComponent_Factory(t) {\n  return new (t || ErrorReportComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.SocketService), i0.ɵɵdirectiveInject(i3.NavbarVisibilityService), i0.ɵɵdirectiveInject(i4.LocationBackService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef));\n};\n\nErrorReportComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ErrorReportComponent,\n  selectors: [[\"app-error-report\"]],\n  decls: 6,\n  vars: 3,\n  consts: [[\"class\", \"d-flex justify-content-center mt-5 pt-5\", 4, \"ngIf\"], [\"id\", \"backBtn\", \"title\", \"Go back\", 3, \"click\"], [1, \"fas\", \"fa-arrow-left\"], [\"id\", \"page\", 4, \"ngIf\"], [1, \"d-flex\", \"justify-content-center\", \"mt-5\", \"pt-5\"], [1, \"spinner\", \"spinner-border\"], [\"id\", \"page\"], [\"id\", \"text\"], [2, \"text-align\", \"center\"], [\"id\", \"bugReportButton\", \"role\", \"button\", 1, \"btn\", \"btn-lg\", \"btn-custom\", 3, \"disabled\", \"click\"], [1, \"col\"], [\"id\", \"stacktrace\"], [\"id\", \"row\"], [\"id\", \"logs\", 1, \"limit\"], [\"id\", \"config\", 1, \"limit\"]],\n  template: function ErrorReportComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, ErrorReportComponent_div_0_Template, 2, 0, \"div\", 0);\n      i0.ɵɵelementStart(1, \"button\", 1);\n      i0.ɵɵlistener(\"click\", function ErrorReportComponent_Template_button_click_1_listener() {\n        return ctx.locationBackService.goBack();\n      });\n      i0.ɵɵelement(2, \"i\", 2);\n      i0.ɵɵtext(3, \" Back\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(4, ErrorReportComponent_div_4_Template, 32, 10, \"div\", 3);\n      i0.ɵɵtemplate(5, ErrorReportComponent_div_5_Template, 6, 0, \"div\", 3);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.loading);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.validReport);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.validReport && !ctx.loading);\n    }\n  },\n  directives: [i5.NgIf],\n  pipes: [i5.DatePipe, i5.JsonPipe],\n  styles: [\"#page[_ngcontent-%COMP%]{height:100%;margin:0 auto;width:80%;font-size:1.9vw;font-family:Calibri,Candara,Segoe,Segoe UI,Optima,Arial,sans-serif;color:#fefeff}@media (min-width: 840px){#page[_ngcontent-%COMP%]{font-size:140%;width:800px}}#text[_ngcontent-%COMP%]{vertical-align:middle}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%]{font-weight:400;padding:0;margin:0 0 25px;font-weight:300}h1[_ngcontent-%COMP%]{font-size:6.5em;margin-bottom:10px}h2[_ngcontent-%COMP%]{font-size:1.5em}h4[_ngcontent-%COMP%]{font-size:1.4em;line-height:1.5em}h5[_ngcontent-%COMP%]{line-height:1.1em;font-size:1.3em}.limit[_ngcontent-%COMP%]{overflow-x:scroll;width:300px}#row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:stretch;justify-content:space-between;height:200px}.col[_ngcontent-%COMP%]{padding:1em}.btn-custom[_ngcontent-%COMP%]{background-color:#fff;color:#007bff;border-color:#007bff}.btn-custom[_ngcontent-%COMP%]:hover{color:#fff;background-color:#0062cc;border-color:#005cbf}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-button{width:0px;height:0px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#e1e1e1;border:0px none #ffffff;border-radius:0}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#ffffff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:active{background:#ffffff}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#868686;border:0px none #ffffff;border-radius:0}[_ngcontent-%COMP%]::-webkit-scrollbar-track:hover{background:#868686}[_ngcontent-%COMP%]::-webkit-scrollbar-track:active{background:#727272}[_ngcontent-%COMP%]::-webkit-scrollbar-corner{background:transparent}#backBtn[_ngcontent-%COMP%]{position:absolute;z-index:99;border:none;outline:none;background-color:#fbfbfb;color:#000;padding:10px;border-radius:5px;font-size:18px;top:10px;left:10px}\"]\n});\n\n__decorate([Confirmable(\"You are running an unofficial copy of TallyArbiter, AKA a fork. Note that doing this you can edit TallyArbiter source code and you can introuce new bugs that not exist in the official version. If you're a developer, and you know that this bug isn't related to your contribution, click 'Ok' to open a bug report on the official Github repository of TallyArbiter.\", false, {\n  icon: \"warning\",\n  title: \"TallyArbiter fork detected\"\n})], ErrorReportComponent.prototype, \"bugReportForkWarning\", null);","map":null,"metadata":{},"sourceType":"module"}